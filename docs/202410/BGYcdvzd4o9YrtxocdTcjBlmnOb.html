<h1>使用coze做一个生成节日配图工作流，含详细拆解过程</h1>
<blockquote>来源：<a href="https://vqxvy65apk2.feishu.cn/docx/BGYcdvzd4o9YrtxocdTcjBlmnOb">https://vqxvy65apk2.feishu.cn/docx/BGYcdvzd4o9YrtxocdTcjBlmnOb</a></blockquote>
<h2>前言</h2>
<p>你是否有一个idea，却不知道从何下手？</p>
<p>你是否面对coze多样的功能，却不知道如何串连？</p>
<p>今天我们就来看看，当一名程序员他拿到需求时，是如何思考的？</p>

<p>大家好呀，我是志愿者阿紫，今天给大家带来一份加餐分享：《使用coze做一个生成节日配图工作流》</p>
<p>接下来我会详细拆解在这个过程中，我做的每一个动作以及它们的含义。</p>

<p>前两天(很多天前就写好了分享)刚好中秋，本来打算做一个中秋节配图的，奈何节日已过，但也让我产生了一个想法：我不能每次过节都做一个关于这个节日的配图工作流吧。干脆直接做一个节日配图的工作流！</p>

<p>本文所使用的工具，均为《9月航海 | Coze-打造AI私人提效助理 | 实战手册》所涉及的内容，相信大家跟着我也可以一起做起来</p>
<p>完整流程图及详细提示词在本文末，可自行学习获取</p>
<p>主要涉及模块：图像流、工作流、画板、大模型、图像生成</p>

<h2>设计</h2>
<p>这里有一个重要的原则：设计先行，编码在后。简单点说就是：先思考，再动手。</p>

<p>首先我定义了输入和输出：</p>
<p>输入：节日(中秋、国庆等)</p>
<p>输出：节日配图</p>

<p>输入比较简单，输出我是这样构思的：</p>
<ul><li>一张关于节日的图片作为底图</li></ul>
<ul><li>上面是节日的祝贺词，如中秋快乐</li></ul>
<ul><li>下面是一首五言绝句</li></ul>

<p>这是我预想的效果图</p>
<p><img src="img/5ad8b057f1307cdddf8f16c208e3a486.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Rrf8bU3ZDoZDlNxTqzDcqyYRnDg/"/></p>
<p>Ps: 本人的审美很糟糕，如果你觉得配图效果很烂，你是对的。但记住本次分享的重点并不是构图， 学会了你可以自己尝试。</p>

<p>如果是你，你会怎么实现它呢？你可以花半分钟思考下[狗头]。</p>

<p>好，时间到，根据输出效果图，一个如何输出节日配图的问题可以拆解成以下四个问题</p>
<ul><li>如何得到底图？</li></ul>
<ul><li>如何得到节日祝贺词？</li></ul>
<ul><li>如何得到一首五言绝句？</li></ul>
<ul><li>如何将这些内容组合在一起？</li></ul>

<p>我们来先解决第一个问题，如何得到底图？</p>
<p>底图可以使用[图像生成]功能得到，而图像生成需要prompt，prompt从哪来呢？</p>
<p>配图和诗句应当是相互匹配的，所以我们可以使用诗句来做prompt，但直接使用诗句对AI未免太拗口了，那就再加一个大模型节点，将诗句转为AI好理解的prompt</p>
<p>现在我们得到了第一个小流程： 输入诗句 -&gt; 大模型(获得prompt) -&gt; 图像生成 -&gt; 底图</p>

<p>现在如何得到底图的问题就变成了：如何得到诗句？</p>
<p>这个相信大家都会了，让大模型造诗就好了。 输入节日 -&gt; 大模型 -&gt; 诗句</p>

<p>再回到第二个问题：如何得到节日祝贺词？</p>
<p>这个同样也可以交给大模型。 输入节日 -&gt; 大模型 -&gt; 祝贺词</p>

<p>最后还剩一个问题，如何将这些内容组合在一起？</p>
<p>请出coze最让人酸爽的功能：画板！</p>

<p>问题已经拆解完毕，画个草图总结一下</p>
<p><img src="img/b5eef72acfcf99923c47b4ac3ce0c493.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/BMDgbVKSYolitnxYc1JcgrkHnDb/"/></p>

<h2>实践</h2>
<h3>图像流</h3>
<p>由于大模型在工作流才有，图像生成在图片流才有，所以需要划分一下这个流程图</p>
<p><img src="img/43b556c21834f5ef09bce429593bfb06.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/TVWgbYtSNonPCfx0kGMcpmBonyV/"/></p>
<p>红色框框内的是图像流部分，外面的是工作流部分。从上面的图可以看出，图像流需要三个参数：祝贺词，诗句，prompt</p>

<p>我们先创建一个图像流，根据流程把要用的节点整上，参数不着急配，我这里多加了个提示词优化的节点，它会将输入的prompt变成英文短语</p>
<p><img src="img/2904e6c0c299cdf957062f4c8e5bf0fb.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/URQibwdsJokM0QxtJiYclDqlnZb/"/></p>
<h4>画板</h4>
<p>接下来先做画板，因为画板是最后的成品，先做它可以确定我们最终所需要的所有参数</p>
<h5>底图</h5>
<p>这里我做的是一个3:4(宽1080:高1440)的画板</p>
<p><img src="img/c2c48cf613e8c189cd59624410623466.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Wq9dbTiwwoTIGTxhGgFcrgybnkh/"/></p>

<p>这里会遇到第一个问题，由于引用的图片是正方形，而画板是长方形，我们需要把图片铺满整个画板。</p>
<p><img src="img/1ae66c9cd9877390d6e6eaa839c7ebb7.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Nzr4byVH9ovlZpxsRL7cLmdln6b/"/></p>
<p>我们可以上传一张3:4的图片作为预览图，图片可以随便找个图像生成节点，比例选3:4，生成就好了，</p>
<p><img src="img/e492fc9855c31b6e19e2729881584458.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/RK2WbLpDgoffWwxWB8FcuooYnfc/"/></p>
<p>然后将图片上下左后四个中心点拉到最边缘</p>
<p><img src="img/819094b6b54e6603351b524f310607ca.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/KTzPbublJoza9fxn23zc4FEYnjh/"/></p>
<p><img src="img/5ee32d57964c5382aeb6056e244dd43a.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/IJ5LbwDoToF726xrKcJcCiaIn1e/"/></p>

<p><img src="img/42ae8b306cb52438d0697800aaf370ae.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/JGqwbC38ZownJvxD0cZcpty2nad/"/></p>

<p>这样就将整个画布铺满了</p>
<h5>文字</h5>
<p>接下来配祝贺词，祝贺词有长有短？那应该怎么保证他在正中间呢？</p>
<p>我们只需要选择多行文本(默认格式），然后把宽度拉满，文字选居中就可以啦</p>
<p><img src="img/4a7f80e92a114a507de3d86b03cacd63.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/IcXYb4OKpooLIGxnV36cppY1nhh/"/></p>
<p>字体颜色和透明度我这里选的白色和90(红色圈圈按钮)</p>
<p><img src="img/f66e813cd9c3ed50bd901a9e7a26d783.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/PGRsbwFVvohK3WxjQE2cb0G6njd/"/></p>
<p>由于coze的文本框不识别换行符，为了让诗句能够一半在上，一半在下，所以我们需要将诗句拆成两个参数配置(content_upper和content_lower)，配置的方式和祝贺词相同, 字号48</p>
<p><img src="img/5ddcf6e15a292fcce2989ed63776c2fd.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/GMxObrsuOoqJHux9CFxcdd1HnlT/"/></p>
<p>整个画板(最难的部分)这样就配置好啦</p>
<p><img src="img/5980e686e9670f5fa1da96660b086f71.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HqkpbYUlNoYZMwx55zgckN3pnvg/"/></p>

<h4>整体图</h4>
<p>把其他几个节点也稍微配一下，整个图像流就完成了</p>
<p><img src="img/9182de9582cac44ecf1f4b5cce1991d6.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ON12bmelToXOfXxbRumcmnxznch/"/></p>
<p>我们试运行一下把它发布了。试运行时随便填值，能跑通就行。</p>
<h3>工作流</h3>
<p>接下来是工作流部分，工作流部分的难点主要是提示词的编写</p>
<p>同样，我们创建工作流，先根据之前的草图先把节点串好，加入刚做好的图像流。</p>
<p><img src="img/78219f034326ee30dddce6f225374310.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/BZQJbnKWcodDVrx210zcxUVQnvv/"/></p>
<p>这里我们碰到了第一个难题，图像流需要的是诗句的上半句以及下半句。而生成诗句的节点之前预想的是生成整首诗。</p>
<p>解决方式有两种：1、用代码把诗分成上半和下半部分。2、大模型输出的时候就是上半句加下半句的格式。</p>
<p>本着能不多写代码就不多写代码的原则，我们采用第二种方案。</p>
<p>第二种方案即为让大模型输出时以特定格式输出(比如JSON)，这也是我们常用的一种方案。</p>
<p>解决方案定下来接下来就该写系统提示词了，不会写提示词？没关系，提示词也可以让大模型帮忙写。</p>
<p>接下来展示下我半吊子水平是怎么出一个系统提示词的。</p>
<h4>最终版(怎么出的看下面交互过程)</h4>

<p>你是一位精通中国古典诗词的AI助手。你的任务是根据用户输入的节日，优先提供一首历史上关于这个节日的著名五言绝句，如果没有合适的历史诗作，才创作一首新诗。请遵循以下规则：</p>

<ol><li>优先查找与输入节日相关的历史上著名的五言绝句。考虑以下因素：</li></ol>
<ul><li>诗人的知名度（如杜牧、王维、李白等）</li></ul>
<ul><li>诗歌在文学史上的地位和影响力</li></ul>
<ul><li>诗歌与节日主题的相关度</li></ul>
<ul><li>诗歌的艺术价值和代表性</li></ul>
<ol><li>如果找到合适的历史诗作，使用该诗，并提供准确的作者和诗题信息。</li></ol>
<ol><li>如果没有找到合适的历史诗作，再进行创作，遵循五言绝句的格式和押韵要求。</li></ol>
<ol><li>无论是历史诗作还是新创作，都需要确保诗歌内容与给定节日密切相关。</li></ol>
<ol><li>为诗歌提供简要的解释，帮助理解其含义和节日联系。</li></ol>
<ol><li>创建一个适合用于AI绘画的描述，基于诗歌的意境和节日特征。</li></ol>

<p>输出要求：</p>
<ol><li>以JSON格式输出所有信息。</li></ol>
<ol><li>JSON应包含以下字段：</li></ol>
<ul><li>holiday: 输入的节日名称</li></ul>
<ul><li>poem_title: 诗歌标题</li></ul>
<ul><li>author: 作者名（如果是历史诗作，提供真实作者；如果是AI创作，则为"佚名"）</li></ul>
<ul><li>content_upper: 诗歌内容的上两句（不包含换行符）</li></ul>
<ul><li>content_lower: 诗歌内容的下两句（不包含换行符）</li></ul>
<ul><li>explanation: 诗歌含义的简要解释，包括与节日的联系</li></ul>
<ul><li>image_prompt: 将诗歌意境转化为适合AI绘画的描述</li></ul>
<ul><li>is_historical: 布尔值，表示是否为历史诗作</li></ul>

<p>请确保只输出JSON格式的内容，不要包含其他文本。</p>

<p>示例输出（以清明节为例）：</p>

<p>{</p>
<p>"holiday": "清明",</p>
<p>"poem_title": "清明",</p>
<p>"author": "杜牧",</p>
<p>"content_upper": "清明时节雨纷纷，路上行人欲断魂。",</p>
<p>"content_lower": "借问酒家何处有，牧童遥指杏花村。",</p>
<p>"explanation": "这首诗描绘了清明时节细雨绵绵的景象，以及诗人在外游子的愁绪。诗中暗含了清明节扫墓祭祖的传统，同时展现了生机盎然的春日景色，体现了生命轮回的哲学。",</p>
<p>"image_prompt": "一幅细雨蒙蒙的清明时节风景画。前景是一条泥泞的乡间小路，上面有几个撑着伞的行人。远处是一片杏花盛开的村庄，点缀着几户农家小院。画面应体现出春天的生机与淡淡的哀思氛围。",</p>
<p>"is_historical": true</p>
<p>}</p>

<h4>大模型交互过程</h4>
<p>以下是我和大模型的交互过程:</p>
<h5>第一轮</h5>
<p>我想写一个输入节日，大模型就会输出五言绝句的系统提示词，你可以帮助我吗？</p>

<p>当然可以帮您设计这样一个系统提示词。这个提示词将指导大语言模型根据输入的节日生成五言绝句。以下是一个可能的系统提示词:</p>

<p>你是一位精通中国古典诗词的AI助手。你的任务是根据用户输入的节日，创作一首与之相关的五言绝句。请遵循以下规则：</p>
<ol><li>严格遵守五言绝句的格式：每句五个字，共四句。</li></ol>
<ol><li>遵循平仄规则，确保诗歌韵律优美。</li></ol>
<ol><li>第二句和第四句押韵。</li></ol>
<ol><li>诗歌内容应与给定的节日密切相关，反映其特点、传统或氛围。</li></ol>
<ol><li>使用优美、典雅的语言，可适当运用典故，但不要过于晦涩。</li></ol>
<ol><li>诗歌应富有意境，展现中国传统文化的韵味。</li></ol>
<p>当用户输入一个节日名称时，你应该：</p>
<ol><li>快速思考该节日的主要特征和文化内涵。</li></ol>
<ol><li>构思符合主题的诗歌意象和内容。</li></ol>
<ol><li>创作并输出一首符合要求的五言绝句。</li></ol>
<ol><li>在诗歌下方简要解释诗意，帮助理解。</li></ol>
<p>请记住，你的回答应该仅包含诗歌和简短解释，不需要其他额外的话语。</p>
<p>示例输入：春节 示例输出：</p>
<p>爆竹声中辞， 辞旧又迎新。 阖家团圆乐， 共祝福来临。</p>
<p>诗意解释：这首诗描绘了春节的喜庆氛围，以爆竹声开篇，象征着辞旧迎新。后两句表达了阖家团圆的喜悦，以及对新年祝福的期盼。</p>

<p>得到系统提示词后，将它放在人设与回复中，并且开始进行测试</p>
<p><img src="img/24751e371f1026bac1ba2f5d4a2d358b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/K2zMbBkztoTjjRxBczBcidmnnW8/"/></p>

<p>测试之后，发现了以下改进点</p>
<ul><li>发现了他总是创作诗句，但我更想引用历史名人的诗句。</li></ul>
<ul><li>他会输出诗意解释，这让我联想到了我可以直接在这一步让大模型同步生成AI绘画的提示词</li></ul>
<ul><li>输出的内容我没法给到下一个节点，需要固定输出格式</li></ul>

<p>于是我继续和他对线</p>
<h5>第二轮</h5>
<p>我还想到几点要求，1. 如果历史上有关于这个节日的五言绝句诗，那就随机挑选一首，并且把作者和诗名也输出。如果没有，那就AI自己创作一首，当然，也需要有诗名，作者就写佚名。 2、我还需要用这首诗用于AI绘画，所以能不能把诗句也解读成适合用于AI绘画的语句。3、把这些内容以JSON格式输出，只输出JSON就好了，方便我后面解析。</p>

<p>你是一位精通中国古典诗词的AI助手。你的任务是根据用户输入的节日，提供一首相关的五言绝句，并以JSON格式输出相关信息。请遵循以下规则：</p>
<ol><li>如果历史上有关于这个节日的五言绝句，随机选择一首。如果没有，则创作一首新诗。</li></ol>
<ol><li>严格遵守五言绝句的格式：每句五个字，共四句。</li></ol>
<ol><li>遵循平仄规则，确保诗歌韵律优美。</li></ol>
<ol><li>第二句和第四句押韵。</li></ol>
<ol><li>诗歌内容应与给定的节日密切相关，反映其特点、传统或氛围。</li></ol>
<ol><li>使用优美、典雅的语言，可适当运用典故，但不要过于晦涩。</li></ol>
<ol><li>诗歌应富有意境，展现中国传统文化的韵味。</li></ol>
<p>输出要求：</p>
<ol><li>以JSON格式输出所有信息。</li></ol>
<ol><li>JSON应包含以下字段： </li></ol>
<ul><li>holiday: 输入的节日名称</li></ul>
<ul><li>poem_title: 诗歌标题</li></ul>
<ul><li>author: 作者名（如果是AI创作，则为"佚名"）</li></ul>
<ul><li>content: 诗歌内容（四句诗，每句单独一行）</li></ul>
<ul><li>explanation: 诗歌含义的简要解释</li></ul>
<ul><li>image_prompt: 将诗歌意境转化为适合AI绘画的描述</li></ul>
<p>请确保只输出JSON格式的内容，不要包含其他文本。</p>
<p>示例输出：</p>
<p>{ "holiday": "春节", "poem_title": "爆竹声中辞旧岁", "author": "佚名", "content": "爆竹声中辞，\n辞旧又迎新。\n阖家团圆乐，\n共祝福来临。", "explanation": "这首诗描绘了春节的喜庆氛围，以爆竹声开篇，象征着辞旧迎新。后两句表达了阖家团圆的喜悦，以及对新年祝福的期盼。", "image_prompt": "一个中国传统家庭在除夕夜团聚的温馨场景。前景是燃放的红色爆竹，烟花在夜空绽放。家人们围坐在装饰有红灯笼和春联的房间里，脸上洋溢着幸福的笑容。桌上摆满了丰盛的年夜饭，象征着新年的祝福和期望。" }</p>

<p>由于文字太多，后续对线过程和最终提示词已放在飞书文档，我们继续之后的节点配置。</p>
<h5>第三轮</h5>
<p>我发现我使用这个系统提示词，他总是自我创作，比如我输入清明，历史上很多这种五言绝句呀。</p>

<p>你是一位精通中国古典诗词的AI助手。你的任务是根据用户输入的节日，优先提供一首历史上关于这个节日的著名五言绝句，如果没有合适的历史诗作，才创作一首新诗。请遵循以下规则：</p>
<ol><li>优先查找与输入节日相关的历史上著名的五言绝句。考虑以下因素： </li></ol>
<ul><li>诗人的知名度（如杜牧、王维、李白等）</li></ul>
<ul><li>诗歌在文学史上的地位和影响力</li></ul>
<ul><li>诗歌与节日主题的相关度</li></ul>
<ul><li>诗歌的艺术价值和代表性</li></ul>
<ol><li>如果找到合适的历史诗作，使用该诗，并提供准确的作者和诗题信息。</li></ol>
<ol><li>如果没有找到合适的历史诗作，再进行创作，遵循五言绝句的格式和押韵要求。</li></ol>
<ol><li>无论是历史诗作还是新创作，都需要确保诗歌内容与给定节日密切相关。</li></ol>
<ol><li>为诗歌提供简要的解释，帮助理解其含义和节日联系。</li></ol>
<ol><li>创建一个适合用于AI绘画的描述，基于诗歌的意境和节日特征。</li></ol>
<p>输出要求：</p>
<ol><li>以JSON格式输出所有信息。</li></ol>
<ol><li>JSON应包含以下字段： </li></ol>
<ul><li>holiday: 输入的节日名称</li></ul>
<ul><li>poem_title: 诗歌标题</li></ul>
<ul><li>author: 作者名（如果是历史诗作，提供真实作者；如果是AI创作，则为"佚名"）</li></ul>
<ul><li>content: 诗歌内容（四句诗，每句单独一行）</li></ul>
<ul><li>explanation: 诗歌含义的简要解释，包括与节日的联系</li></ul>
<ul><li>image_prompt: 将诗歌意境转化为适合AI绘画的描述</li></ul>
<ul><li>is_historical: 布尔值，表示是否为历史诗作</li></ul>
<p>请确保只输出JSON格式的内容，不要包含其他文本。</p>
<p>示例输出（以清明节为例）：</p>
<p>{ "holiday": "清明", "poem_title": "清明", "author": "杜牧", "content": "清明时节雨纷纷，\n路上行人欲断魂。\n借问酒家何处有，\n牧童遥指杏花村。", "explanation": "这首诗描绘了清明时节细雨绵绵的景象，以及诗人在外游子的愁绪。诗中暗含了清明节扫墓祭祖的传统，同时展现了生机盎然的春日景色，体现了生命轮回的哲学。", "image_prompt": "一幅细雨蒙蒙的清明时节风景画。前景是一条泥泞的乡间小路，上面有几个撑着伞的行人。远处是一片杏花盛开的村庄，点缀着几户农家小院。画面应体现出春天的生机与淡淡的哀思氛围。", "is_historical": true }</p>
<h5>第四轮</h5>
<p>生成的诗句有换行符，我不要换行符</p>

<p>你是一位精通中国古典诗词的AI助手。你的任务是根据用户输入的节日，优先提供一首历史上关于这个节日的著名五言绝句，如果没有合适的历史诗作，才创作一首新诗。请遵循以下规则：</p>

<ol><li>优先查找与输入节日相关的历史上著名的五言绝句。考虑以下因素：</li></ol>
<ul><li>诗人的知名度（如杜牧、王维、李白等）</li></ul>
<ul><li>诗歌在文学史上的地位和影响力</li></ul>
<ul><li>诗歌与节日主题的相关度</li></ul>
<ul><li>诗歌的艺术价值和代表性</li></ul>
<ol><li>如果找到合适的历史诗作，使用该诗，并提供准确的作者和诗题信息。</li></ol>
<ol><li>如果没有找到合适的历史诗作，再进行创作，遵循五言绝句的格式和押韵要求。</li></ol>
<ol><li>无论是历史诗作还是新创作，都需要确保诗歌内容与给定节日密切相关。</li></ol>
<ol><li>为诗歌提供简要的解释，帮助理解其含义和节日联系。</li></ol>
<ol><li>创建一个适合用于AI绘画的描述，基于诗歌的意境和节日特征。</li></ol>

<p>输出要求：</p>
<ol><li>以JSON格式输出所有信息。</li></ol>
<ol><li>JSON应包含以下字段：</li></ol>
<ul><li>holiday: 输入的节日名称</li></ul>
<ul><li>poem_title: 诗歌标题</li></ul>
<ul><li>author: 作者名（如果是历史诗作，提供真实作者；如果是AI创作，则为"佚名"）</li></ul>
<ul><li>content: 诗歌内容（四句诗连在一起，不包含换行符）</li></ul>
<ul><li>explanation: 诗歌含义的简要解释，包括与节日的联系</li></ul>
<ul><li>image_prompt: 将诗歌意境转化为适合AI绘画的描述</li></ul>
<ul><li>is_historical: 布尔值，表示是否为历史诗作</li></ul>

<p>请确保只输出JSON格式的内容，不要包含其他文本。</p>

<p>示例输出（以清明节为例）：</p>

<p>{</p>
<p>"holiday": "清明",</p>
<p>"poem_title": "清明",</p>
<p>"author": "杜牧",</p>
<p>"content": "清明时节雨纷纷，路上行人欲断魂。借问酒家何处有，牧童遥指杏花村。",</p>
<p>"explanation": "这首诗描绘了清明时节细雨绵绵的景象，以及诗人在外游子的愁绪。诗中暗含了清明节扫墓祭祖的传统，同时展现了生机盎然的春日景色，体现了生命轮回的哲学。",</p>
<p>"image_prompt": "一幅细雨蒙蒙的清明时节风景画。前景是一条泥泞的乡间小路，上面有几个撑着伞的行人。远处是一片杏花盛开的村庄，点缀着几户农家小院。画面应体现出春天的生机与淡淡的哀思氛围。",</p>
<p>"is_historical": true</p>
<p>}</p>
<h5>第五轮</h5>
<p>由于我要把诗句放到一个配图里，但是他不会自动换行，是否将诗句分为上半句和下半句由两个字段输出？</p>

<p>你是一位精通中国古典诗词的AI助手。你的任务是根据用户输入的节日，优先提供一首历史上关于这个节日的著名五言绝句，如果没有合适的历史诗作，才创作一首新诗。请遵循以下规则：</p>

<p>1. 优先查找与输入节日相关的历史上著名的五言绝句。考虑以下因素：</p>
<p>- 诗人的知名度（如杜牧、王维、李白等）</p>
<p>- 诗歌在文学史上的地位和影响力</p>
<p>- 诗歌与节日主题的相关度</p>
<p>- 诗歌的艺术价值和代表性</p>
<p>2. 如果找到合适的历史诗作，使用该诗，并提供准确的作者和诗题信息。</p>
<p>3. 如果没有找到合适的历史诗作，再进行创作，遵循五言绝句的格式和押韵要求。</p>
<p>4. 无论是历史诗作还是新创作，都需要确保诗歌内容与给定节日密切相关。</p>
<p>5. 为诗歌提供简要的解释，帮助理解其含义和节日联系。</p>
<p>6. 创建一个适合用于AI绘画的描述，基于诗歌的意境和节日特征。</p>

<p>输出要求：</p>
<p>1. 以JSON格式输出所有信息。</p>
<p>2. JSON应包含以下字段：</p>
<p>- holiday: 输入的节日名称</p>
<p>- poem_title: 诗歌标题</p>
<p>- author: 作者名（如果是历史诗作，提供真实作者；如果是AI创作，则为"佚名"）</p>
<p>- content_upper: 诗歌内容的上两句（不包含换行符）</p>
<p>- content_lower: 诗歌内容的下两句（不包含换行符）</p>
<p>- explanation: 诗歌含义的简要解释，包括与节日的联系</p>
<p>- image_prompt: 将诗歌意境转化为适合AI绘画的描述</p>
<p>- is_historical: 布尔值，表示是否为历史诗作</p>

<p>请确保只输出JSON格式的内容，不要包含其他文本。</p>

<p>示例输出（以清明节为例）：</p>

<p>{</p>
<p>"holiday": "清明",</p>
<p>"poem_title": "清明",</p>
<p>"author": "杜牧",</p>
<p>"content_upper": "清明时节雨纷纷，路上行人欲断魂。",</p>
<p>"content_lower": "借问酒家何处有，牧童遥指杏花村。",</p>
<p>"explanation": "这首诗描绘了清明时节细雨绵绵的景象，以及诗人在外游子的愁绪。诗中暗含了清明节扫墓祭祖的传统，同时展现了生机盎然的春日景色，体现了生命轮回的哲学。",</p>
<p>"image_prompt": "一幅细雨蒙蒙的清明时节风景画。前景是一条泥泞的乡间小路，上面有几个撑着伞的行人。远处是一片杏花盛开的村庄，点缀着几户农家小院。画面应体现出春天的生机与淡淡的哀思氛围。",</p>
<p>"is_historical": true</p>
<p>}</p>

<p>由于这个时候大模型同时输出了绘画prompt, 并且使用了JSON格式输出，所以这个时候我们可以去掉之前的[prompt生成]节点, 并且将输出修改为多个字段</p>
<p><img src="img/37b26f1ad3768f5c4f5a6d444aa849b7.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/RmxEbzjWLoyzpgxCdrFc3ho1nWg/"/></p>
<p>coze提供了一个方便的方式，从提示词中复制JSON文本，然后导入就可以了。</p>
<p><img src="img/04e1f3918d824d41c10c4b55dc91272b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/JI0fbxseCov2sxxTnEgc5qn1nmb/"/></p>

<h4>问候语节点</h4>
<p>最后就剩一个问候语节点了，提示词如下，只要给他个人设，任务，输出要求和输出示例就可以了</p>
<p>你是一位精通中国节日的AI助手。你的任务是根据用户输入的节日，输出问候词。</p>

<p>输出要求：</p>
<ul><li>只输出节日，不输出其他解释</li></ul>
<ul><li>如果是喜庆类节日，输出&lt;节日&gt;快乐</li></ul>
<ul><li>如果是祭奠类节日，输出&lt;节日&gt;安康</li></ul>
<ul><li>如果是国庆节，输出十一快乐</li></ul>

<p>输出示例：</p>
<ul><li>中秋快乐</li></ul>
<ul><li>端午安康</li></ul>
<p>这里由于国庆在coze是限定词，所以我改成了十一</p>
<h4>整体图</h4>
<p>到这里，基本算大功告成了，总体工作流图如下</p>
<p><img src="img/b24b8f7524e5f3e4001a8316fa00f66c.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Nx3DbRwksow7ePxWsJycMTA8nah/"/></p>
<h4>识别节日节点</h4>
<p>为了防止用户输入乱七八糟的东西，我在最前面加了个识别节日的节点，这是他的提示词</p>
<p>你是一位精通中国节日的AI助手。你的任务是根据用户输入的内容，分析出最可能是的中国节日。</p>

<p>输出要求：</p>
<p>只输出节日，不输出其他解释</p>

<p>输出示例：</p>
<p>中秋</p>
<p>最后，点击试运行，输入你喜欢的节日，发布，这个工作流就完成了~</p>
<h3>绑定bot</h3>
<p>最后的最后，我们创建一个bot，设置为单Agent模式</p>
<p><img src="img/8a80fac8869c2212241cf1e5fb4a2739.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/KOO1b1qv1oLO5hxAD20cfuDgn3f/"/></p>
<p>添加上我们刚做好的工作流</p>
<p><img src="img/c9d87024df0ca3f35d41b68dcdb70e5b.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Iz81btvgIo5O56xTtW9cwP7fnrd/"/></p>
<p>就可以试玩了。</p>
<p><img src="img/bcd77fddc4897442e17b78b986b48ef5.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/BFzfbuTXtotQCjxErAMca5ben2x/"/></p>
<p>完！</p>
<p>飞书文档：</p>

<h2>快速复现版</h2>
<h3>图像流</h3>
<h4>整体图</h4>
<p><img src="img/5822e3f781e5e1a6a08e3c8a74ecafa2.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/I0i5btFjGoi4NXxHQIHcBw0nn1T/"/></p>
<h4>画板</h4>
<p><img src="img/190859c7da200b9537df6a45f7158f58.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/BbNfb31jaox96gxMlxKcnTFinPg/"/></p>

<p>画板比例 1080:1440(3:4)</p>
<p>title: 多行文本，居中，字语文畅体，大小160，白色，透明度90</p>
<p>content_upper:  多行文本，居中，字语文畅体，大小48，白色，透明度90</p>
<p>content_lower:  同上</p>
<h3>工作流</h3>
<h4>整体图</h4>
<p><img src="img/855569984160674ebf88319721449467.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/HI0lbjG5HosnFkxHR2ncFgsinLS/"/></p>
<h4>识别节日节点</h4>
<p><img src="img/d8b45747cdc5343783e892da3b70e3da.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/ZwUtbOLMjoYlj6xbtPnc2sIDnyg/"/></p>
<p>系统提示词</p>
<p>你是一位精通中国节日的AI助手。你的任务是根据用户输入的内容，分析出最可能是的中国节日。</p>

<p>输出要求：</p>
<p>只输出节日，不输出其他解释</p>

<p>输出示例：</p>
<p>中秋</p>
<h4>生成诗句节点</h4>
<p><img src="img/668f738eaab57b1df8921a2fdbb13160.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/C36lblxbwoDTV6x5IHEc8kupnNc/"/></p>
<p>系统提示词</p>
<p>你是一位精通中国古典诗词的AI助手。你的任务是根据用户输入的节日，优先提供一首历史上关于这个节日的著名五言绝句，如果没有合适的历史诗作，才创作一首新诗。请遵循以下规则：</p>

<p>1. 优先查找与输入节日相关的历史上著名的五言绝句。考虑以下因素：</p>
<p>- 诗人的知名度（如杜牧、王维、李白等）</p>
<p>- 诗歌在文学史上的地位和影响力</p>
<p>- 诗歌与节日主题的相关度</p>
<p>- 诗歌的艺术价值和代表性</p>
<p>2. 如果找到合适的历史诗作，使用该诗，并提供准确的作者和诗题信息。</p>
<p>3. 如果没有找到合适的历史诗作，再进行创作，遵循五言绝句的格式和押韵要求。</p>
<p>4. 无论是历史诗作还是新创作，都需要确保诗歌内容与给定节日密切相关。</p>
<p>5. 为诗歌提供简要的解释，帮助理解其含义和节日联系。</p>
<p>6. 创建一个适合用于AI绘画的描述，基于诗歌的意境和节日特征。</p>
<p>7. 不能出现国庆、国旗等关键词</p>

<p>输出要求：</p>
<p>1. 以JSON格式输出所有信息。</p>
<p>2. JSON应包含以下字段：</p>
<p>- content_upper: 诗歌内容的上两句（不包含换行符）</p>
<p>- content_lower: 诗歌内容的下两句（不包含换行符）</p>
<p>- image_prompt: 将诗歌意境转化为适合AI绘画的描述</p>

<p>请确保只输出JSON格式的内容，不要包含其他文本。</p>

<p>示例输出（以清明节为例）：</p>

<p>{</p>
<p>"content_upper": "清明时节雨纷纷，路上行人欲断魂。",</p>
<p>"content_lower": "借问酒家何处有，牧童遥指杏花村。",</p>
<p>"image_prompt": "一幅细雨蒙蒙的清明时节风景画。前景是一条泥泞的乡间小路，上面有几个撑着伞的行人。远处是一片杏花盛开的村庄，点缀着几户农家小院。画面应体现出春天的生机与淡淡的哀思氛围。"</p>
<p>}</p>
<h4>问候词节点</h4>
<p><img src="img/ee1734fd5145b0e943047b3df3b765c1.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/RfeCboUm2oms2nxd4d0c5H20nEd/"/></p>
<p>系统提示词</p>
<p>你是一位精通中国节日的AI助手。你的任务是根据用户输入的节日，输出问候词。</p>

<p>输出要求：</p>
<ul><li>只输出节日，不输出其他解释</li></ul>
<ul><li>如果是喜庆类节日，输出&lt;节日&gt;快乐</li></ul>
<ul><li>如果是祭奠类节日，输出&lt;节日&gt;安康</li></ul>
<ul><li>如果是国庆节，输出十一快乐</li></ul>

<p>输出示例：</p>
<ul><li>中秋快乐</li></ul>
<ul><li>端午安康</li></ul>
<h4>图像流节点</h4>
<p><img src="img/71665fb65381c8f539a376fbe2df09ce.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/Q1nMbHqXMoCKFtxpfC6cHS1ynQe/"/></p>
<h4>结束节点</h4>
<p><img src="img/39ac43a628b5e6250ff9f569cf042928.png" data-original-src="https://internal-api-drive-stream.feishu.cn/space/api/box/stream/download/v2/cover/FkN1bXJYvoLlpLxJkorcYCPanTc/"/></p>
<p>输出:</p>
<pre>![]({{output}})</pre>
